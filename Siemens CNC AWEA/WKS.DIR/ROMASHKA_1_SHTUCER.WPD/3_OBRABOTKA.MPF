;;
N1 G54      ;_!!!_
N2 ROT Z=0  ;_!!!_
;
N1 R82=1       ;Nachalo (0-Dp->nar ugol |#| 1-srazu nar ugol)
;_________Detal'_________
N2 R50=108/2  ;MAX Nar R det
N3 R51=95/2  ;MIN R vnutr
N4 R2=96/2   ;R Dp 
N5 R3=20       ;L Dp
N6 R80=1      ;Prituplenie
N7 R55=30     ;Ugol faski NAR
N8 R57=10     ;L faski NAR
N9 R41=12 ; Ugol faski v Dp
N10 R40=20    ;L faski v Dp

;___Freza Dp i vnutr ugol__
N11 R1=140/2    ;Rfr Dp
N12 R201=3    ;T NOMER INSTRUMENTA
N13 R54=4       ;R plastini Dp
N14 R4=1      ;Shag rastochki v Dp
N15 R42=0.8     ;Shag faski v Dp
N16 R31=150     ;Oboroti Dp
N17 R59=1500    ;Podacha Dp
N18 R62=1500    ;Podacha faski v Dp
N19 R88=1       ;0-bez ohlagd.,  1-voda,  2-vozduh

;_______Freza nar ugol_____
N19 R56=0.2     ;Shag NAR ugla 30'-0.24/35'-0.3
N20 R52=63/2    ;Rfr NAR
N21 R53=1.6       ;R plastitni NAR
N22 R200=10     ;T nomer frezi NAR
N23 R35=900    ;Oboroti NAR
N24 R58=2500    ;Podacha NAR
N19 R89=1       ;0-bez ohlagd,  1-voda,  2-vozduh
;******************
N25 R63=20 ;Bezopas rasstojanie
N26 R30=R2-R1;(RADIUS RASTOCHKI S UCHETOM R FREZI)
N27 R32=0  ;Nachalo Z0 NA TORCE
N28 R61=R3+R54;L Dp+Rpl Dp
;_____Korrektora tut_____(_KORREKTORA_.SPF)
N29 _KORREKTORA_
N30 G90
;________________________
;*****************
N31 IF R82==1 GOTOF _NAR_UGOL_
;****************
;---RASTOCHKA Dp---
;****************
N32 MSG ("--- RASTOCHKA Dp= "<<R2*2<<" mm  Lp= "<<R3<<" mm ---")
N33 R33=R32
N34 T=R201
N35 M6 D1
N36 G0 G90 G17 G64 G94
N37 Z300
N37 X=COS(90+22)*(R51-R1-R63) Y=SIN(90+22)*(R51-R1-R63) W0 B0
N39 M3 S=R31
N40 G0 Z0 ;M1
N41 IF R88==1
N42   M8
N43 ENDIF
N44 IF R88==2
N45   M7
N46 ENDIF
N42 WHILE R33>-R61
N43    R33=R33-R4
N44 IF R33<-R61
N45    R33=-R61
N46 ENDIF
N47 G0 Z=R33
;N67 G0 X0 Y=R30+R17-R51;ISHOD (.)?????
;N68 G0 X0 Y=R51-R1-R63 ;ISHOD (.)
N48 G0 X=COS(90+22)*(R51-R1-R63) Y=SIN(90+22)*(R51-R1-R63);ISHOD (.)
;N70 M1
;N69 G1 X0 Y=R30+R17 F400;(.)12
N49 G2 X0 Y=R30+R17 CR=R30+R17 F=R59*0.8;(.)12
N50 G2 X=(R30+R6)/2 Y=(R30+R6)*COS(30) CR=R30+R18 F=R59 ;(.)1
N51 G2 X=(R30+R7)*COS(30) Y=(R30+R7)/2 CR=R30+R19 F=R59 ;(.)2
N52 G2 X=(R30+R8) Y=0 CR=R30+R20 F=R59 ;(.)3
N53 G2 X=(R30+R9)*COS(30) Y=-(R30+R9)/2 CR=R30+R21 F=R59 ;(.)4
N54 G2 X=(R30+R10)/2 Y=-(R30+R10)*COS(30) CR=R30+R22 F=R59  ;(.)5
N55 G2 X0 Y=-(R30+R11) CR=R30+R23 F=R59 ;(.)6
N56 G2 X=-(R30+R12)/2 Y=-(R30+R12)*COS(30) CR=R30+R24 F=R59 ;(.)7
N57 G2 X=-(R30+R13)*COS(30) Y=-(R30+R13)/2 CR=R30+R25 F=R59 ;(.)8
N58 G2 X=-(R30+R14) Y=0 CR=R30+R26 F=R59 ;(.)9
N59 G2 X=-(R30+R15)*COS(30) Y=(R30+R15)/2 CR=R30+R27 F=R59 ;(.)10
N60 G2 X=-(R30+R16)/2 Y=(R30+R16)*COS(30) CR=R30+R28 F=R59 ;(.)11
N61 G2 X0 Y=R30+R17 CR=R30+R29 F=R59 ;(.)12
;N81 G0 X0 Y=R30+R17-R51;ISHOD (.)
;N82 G0 X0 Y=R51-R1-R63 ;ISHOD (.)
N62 G0 X=COS(90+22)*(R51-R1-R63) Y=SIN(90+22)*(R51-R1-R63);ISHOD (.)
N63 ENDWHILE
N64 M1
;****************
;VNUTR UGOL
;****************
N65 R43=1;0 ;Shetcik vnutr ugol
N66 R45=-R61
N67 R70=R40+R61
N68 MSG ("VNUTR UGOL = "<<R41<<" grad  Zkon= - "<<R70<<" mm")
N69 G0 Z=R45
N70 IF R88==1
N71   M8
N72 ENDIF
N73 IF R88==2
N74   M7
N75 ENDIF
N70 WHILE R45>-R70
N71       R45=R45-R42
N72 IF    R45<-R70
N73       R45=-R70
N74 ENDIF
N75 G0 Z=R45
N76 R44=-(R42*(TAN(R41))*R43);Prirashenie po uglu
;N98 G0 X0 Y=R51-R1-R63 ;ISHOD (.)
N77 G0 X=COS(90+22)*(R51-R1-R63) Y=SIN(90+22)*(R51-R1-R63);ISHOD (.)
;N99 G1 X0 Y=R30+R17+R44 F400;(.)12
N78 G2 X0 Y=R30+R17+R44 CR=R30+R17+R44 F=R62*0.85;(.)12

N79 G2 X=(R30+R6+R44)*COS(60) Y=(R30+R6+R44)*SIN(60) CR=R30+R18+R44  F=R62 ;(.)1
N80 G2 X=(R30+R7+R44)*COS(30) Y=(R30+R7+R44)*SIN(30) CR=R30+R19+R44  F=R62 ;(.)2
N81 G2 X=R30+R8+R44 Y=0 CR=R30+R20+R44 F=R62 ;(.)3
N82 G2 X=(R30+R9+R44)*COS(330) Y=(R30+R9+R44)*SIN(330) CR=R30+R21+R44 F=R62 ;(.)4
N83 G2 X=(R30+R10+R44)*COS(300) Y=(R30+R10+R44)*SIN(300) CR=R30+R22+R44 F=R62 ;(.)5
N84 G2 X=0 Y=-(R30+R11+R44) CR=R30+R23+R44 F=R62 ;(.)6
N85 G2 X=(R30+R12+R44)*COS(240) Y=(R30+R12+R44)*SIN(240) CR=R30+R24+R44 F=R62 ;(.)7
N86 G2 X=(R30+R13+R44)*COS(210) Y=(R30+R13+R44)*SIN(210) CR=R30+R25+R44 F=R62 ;(.)8
N87 G2 X=-(R30+R14+R44) Y=0 CR=R30+R26+R44 F=R62 ;(.)9
N88 G2 X=(R30+R15+R44)*COS(150) Y=(R30+R15+R44)*SIN(150) CR=R30+R27+R44 F=R62 ;(.)10
N89 G2 X=(R30+R16+R44)*COS(120) Y=(R30+R16+R44)*SIN(120) CR=R30+R28+R44 F=R62 ;(.)11
N90 G2 X=0 Y=R30+R17+R44 CR=R30+R29+R44 F=R62 ;(.)12
;N110 G0 X0 Y=R30+R17-R51 ;ISHOD (.)???
;N113 G0 X0 Y=R51-R1-R63 ;ISHOD (.)
N91 G0 X=COS(90+22)*(R51-R1-R63) Y=SIN(90+22)*(R51-R1-R63);ISHOD (.)

N92 R43=R43+1
N93 ENDWHILE
N94 G0 Z300 M9
N95 M1
N96 _NAR_UGOL_:
;**************
;---NAR UGOL---
;***************
N97 MSG (" NAR UGOL = "<<R55<<" grad Prituplenie= "<<R80<<" Lfaski "<<R57<<" ")
N98 R60=(SQRT(2*POT(R53)))-R53    ;Korrektor na Rpl frezi
N99 R64=0       ;Shetcik nar ugol
;N121 R67=R52+R80+R2-R60 ;R nachala ugla(Rdk+Rfr+prituplenie)
N100 R67=R52+R80+R2-(R60*TAN(90-R55)) ;R nachala ugla(Rdk+Rfr+prituplenie)
;****************
N35 IF NUMBER($TC_TP2[$TC_MPP6[9998,1]])<>R200
N36     M00
N37 ENDIF
N101 T=R200
N102 M6 D1
N103 G0 G90 G17 G64 G94
N104 Z300
N104 X0 Y0 W0 B0
N106 R34=R32
N107 M3 S=R35
N108 G0 X0 Y=R50+R52+R63;ISH(.)
N70 IF R89==1
N71   M8
N72 ENDIF
N73 IF R89==2
N74   M7
N75 ENDIF
N109 Z=R34 ;M1
N110 WHILE R34>-R57
N111       R34=R34-R56
N112 IF    R34<-R57
N113       R34=-R57
N114 ENDIF
N115 G1 Z=R34 F300
N116 R65=(R56*(1/TAN(R55))*R64) ;Prirashenie po nar uglu
N117 G0 X0 Y=R50+R52+R63;ISH(.)
N118 G1 X0 Y=R67+R17+R65 F500 ;(.)12
N119 G2 X=(R67+R6+R65)*COS(60) Y=(R67+R6+R65)*SIN(60) CR=R67+R18+R65  F=R58 ;(.)1
N120 G2 X=(R67+R7+R65)*COS(30) Y=(R67+R7+R65)*SIN(30) CR=R67+R19+R65  F=R58 ;(.)2
N121 G2 X=R67+R8+R65 Y=0 CR=R67+R20+R65 F=R58 ;(.)3
N122 G2 X=(R67+R9+R65)*COS(330) Y=(R67+R9+R65)*SIN(330) CR=R67+R21+R65 F=R58 ;(.)4
N123 G2 X=(R67+R10+R65)*COS(300) Y=(R67+R10+R65)*SIN(300) CR=R67+R22+R65 F=R58 ;(.)5
N124 G2 X=0 Y=-(R67+R11+R65) CR=R67+R23+R65 F=R58 ;(.)6
N125 G2 X=(R67+R12+R65)*COS(240) Y=(R67+R12+R65)*SIN(240) CR=R67+R24+R65 F=R58 ;(.)7
N126 G2 X=(R67+R13+R65)*COS(210) Y=(R67+R13+R65)*SIN(210) CR=R67+R25+R65 F=R58 ;(.)8
N127 G2 X=-(R67+R14+R65) Y=0 CR=R67+R26+R65 F=R58 ;(.)9
N128 G2 X=(R67+R15+R65)*COS(150) Y=(R67+R15+R65)*SIN(150) CR=R67+R27+R65 F=R58 ;(.)10
N129 G2 X=(R67+R16+R65)*COS(120) Y=(R67+R16+R65)*SIN(120) CR=R67+R28+R65 F=R58 ;(.)11
N130 G2 X=0 Y=R67+R17+R65 CR=R67+R29+R65 F=R58 ;(.)12
;N110 G0 X0 Y=R67+R17-R51 ;ISHOD (.)???
N131 G0 X0 Y=R50+R52+R63;ISH(.)
N132 R64=R64+1
N133 ENDWHILE
N134 G0 Z300 M9
N135 X0 Y0
N136 MSG
N137 M30
